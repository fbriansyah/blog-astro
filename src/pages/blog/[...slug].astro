---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
    const posts = await getCollection('blog');
    return posts.map(post => ({
        params: { slug: post.slug },
        props: { post },
    }));
}

const { post } = Astro.props;
if (!post) {
    return Astro.redirect('/404');
}
const { Content } = await post.render();
---

<Layout 
	title={post.data.title}
	description={post.data.description}
	image={post.data.image}
	article={true}
>
	<script type="application/ld+json" set:html={JSON.stringify({
		"@context": "https://schema.org",
		"@type": "BlogPosting",
		"headline": post.data.title,
		"image": post.data.image,
		"datePublished": post.data.publishDate,
		"author": {
			"@type": "Person",
			"name": post.data.author
		},
		"description": post.data.description
	})} />
    <article class="max-w-4xl mx-auto prose lg:prose-xl dark:prose-invert prose-headings:dark:text-white prose-p:dark:text-gray-300 prose-strong:dark:text-white prose-ul:dark:text-gray-300 prose-ol:dark:text-gray-300">
        <h1>{post.data.title}</h1>
        <div class="text-gray-600 dark:text-gray-400 mb-8">
            <time datetime={post.data.publishDate.toISOString()}>
                {post.data.publishDate.toLocaleDateString()}
            </time>
            â€¢ {post.data.author}
        </div>
        {post.data.image && (
            <img 
                src={post.data.image} 
                alt={post.data.title}
                class="rounded-lg shadow-md mb-8"
            />
        )}
        <Content />
    </article>
</Layout>
