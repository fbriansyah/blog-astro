---
import { languages } from '../content/config';

const { currentLanguage } = Astro.props;
const currentPath = Astro.url.pathname;

function getLanguagePath(lang: string) {
  const segments = currentPath.split('/').filter(Boolean); // Remove empty segments
  
  // Handle blog posts: /blog/[language]/[slug]
  if (segments[0] === 'blog' && segments.length > 1) {
    const newSegments = ['blog', lang];
    // If there's a slug (either after language code or directly after blog)
    if (segments[1] in languages && segments[2]) {
      newSegments.push(segments[2]);
    } else if (!(segments[1] in languages)) {
      newSegments.push(segments[1]);
    }
    return '/' + newSegments.join('/');
  }
  // Handle portfolio: /portfolio/[language]/[slug]
  else if (segments[0] === 'portfolio' && segments.length > 1) {
    const newSegments = ['portfolio', lang];
    // If there's a slug (either after language code or directly after portfolio)
    if (segments[1] in languages && segments[2]) {
      newSegments.push(segments[2]);
    } else if (!(segments[1] in languages)) {
      newSegments.push(segments[1]);
    }
    return '/' + newSegments.join('/');
  }
  // Handle other pages
  else {
    if (segments[0] in languages) {
      segments[0] = lang;
    } else {
      segments.unshift(lang);
    }
    return '/' + segments.join('/');
  }
}
---

<div class="relative inline-block text-left">
  <select
    class="block w-full px-4 py-2 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
    onchange="window.location.href=this.value"
  >
    {Object.entries(languages).map(([code, name]) => (
      <option value={getLanguagePath(code)} selected={getLanguagePath(currentLanguage) === getLanguagePath(code)}>
        {name}
      </option>
    ))}
  </select>
</div>
